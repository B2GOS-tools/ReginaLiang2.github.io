(window.webpackJsonp=window.webpackJsonp||[]).push([[54],{130:function(e,a,r){"use strict";r.r(a),r.d(a,"frontMatter",(function(){return i})),r.d(a,"metadata",(function(){return l})),r.d(a,"rightToc",(function(){return s})),r.d(a,"default",(function(){return m}));var n=r(3),t=r(8),o=(r(0),r(396)),i={id:"navigator-b2g-alarmManager",title:"navigator.b2g.alarmManager"},l={unversionedId:"09.migration-from-2.5/next-new-apis/b2g/alarmManager/navigator-b2g-alarmManager",id:"version-sfp-3.0/09.migration-from-2.5/next-new-apis/b2g/alarmManager/navigator-b2g-alarmManager",isDocsHomePage:!1,title:"navigator.b2g.alarmManager",description:"Description",source:"@site/versioned_docs/version-sfp-3.0/09.migration-from-2.5/next-new-apis/b2g/alarmManager/readme.md",slug:"/09.migration-from-2.5/next-new-apis/b2g/alarmManager/navigator-b2g-alarmManager",permalink:"/docs/sfp-3.0/09.migration-from-2.5/next-new-apis/b2g/alarmManager/navigator-b2g-alarmManager",version:"sfp-3.0"},s=[{value:"Description",id:"description",children:[]},{value:"Get all alarms",id:"get-all-alarms",children:[]},{value:"Add an alarm",id:"add-an-alarm",children:[]},{value:"Remove an alarm",id:"remove-an-alarm",children:[]},{value:"Handle alarm",id:"handle-alarm",children:[{value:"Subscribe alarm",id:"subscribe-alarm",children:[]},{value:"Receive alarm",id:"receive-alarm",children:[]}]},{value:"TODO",id:"todo",children:[{value:"Handle system time and timezone change",id:"handle-system-time-and-timezone-change",children:[]},{value:"Test on CPU wake lock",id:"test-on-cpu-wake-lock",children:[]},{value:"Test listener cleanup on inner-window-destroyed",id:"test-listener-cleanup-on-inner-window-destroyed",children:[]}]}],c={rightToc:s};function m(e){var a=e.components,r=Object(t.a)(e,["components"]);return Object(o.b)("wrapper",Object(n.a)({},c,r,{components:a,mdxType:"MDXLayout"}),Object(o.b)("h2",{id:"description"},"Description"),Object(o.b)("p",null,"Alarm API allows applications to schedule notification at a specific time in the future. For example, some applications like alarm-clock, calendar or auto-update might need to utilize the Alarm API to trigger particular device behaviors at specified time points."),Object(o.b)("p",null,"Alarms persist after reboot. When bootup, all expired alarms are fired immediately. When an alarm is fired, it is dispatched to applications through the System Message API, so applications which want to react to alarms have to register themselves to the alarm messages."),Object(o.b)("p",null,"Alarm API exposes to both ",Object(o.b)("em",{parentName:"p"},"Window")," and ",Object(o.b)("em",{parentName:"p"},"Worker")," scope."),Object(o.b)("h2",{id:"get-all-alarms"},"Get all alarms"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-javascript"}),'navigator.b2g.alarmManager.getAll().then(\n  (list) => console.log(list), // Array of alarm objects.\n  (err) => console.log("getAll err: " + err)\n);\n')),Object(o.b)("h2",{id:"add-an-alarm"},"Add an alarm"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-javascript"}),'options =\n  {\n    "date": new Date(Date.now() + 10*60*1000),\n    "data": {"note": "take a nap"},\n    "ignoreTimezone": false\n  };\n\nnavigator.b2g.alarmManager.add(options).then(\n  (id) => console.log("add id: " + id),\n  (err) => console.log("add err: " + err)\n);\n')),Object(o.b)("h2",{id:"remove-an-alarm"},"Remove an alarm"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-javascript"}),"navigator.b2g.alarmManager.remove(7);\n")),Object(o.b)("h2",{id:"handle-alarm"},"Handle alarm"),Object(o.b)("p",null,'Applications need to subscribe system message of type "alarm" to receive alarm messages. For more details, please see ',Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"../messages/README.md"}),"Subscribe system messages")),Object(o.b)("h3",{id:"subscribe-alarm"},"Subscribe alarm"),Object(o.b)("h4",{id:"use-from-main-scripts"},"Use from main scripts"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-javascript"}),'navigator.serviceWorker.register("sw.js").then(registration => {\n  registration.systemMessageManager.subscribe("alarm").then(\n    rv => {\n      console.log(\'Successfully subscribe system messages of name "alarm".\');\n    },\n    error => {\n      console.log("Fail to subscribe system message, error: " + error);\n    }\n  );\n});\n')),Object(o.b)("h3",{id:"receive-alarm"},"Receive alarm"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-javascript"}),'self.onsystemmessage = (e) => {\n  console.log("receive systemmessage event on sw.js!");\n  console.log(e.data.json()); // The alarm object\n};\n')),Object(o.b)("h2",{id:"todo"},"TODO"),Object(o.b)("h3",{id:"handle-system-time-and-timezone-change"},"Handle system time and timezone change"),Object(o.b)("h3",{id:"test-on-cpu-wake-lock"},"Test on CPU wake lock"),Object(o.b)("h3",{id:"test-listener-cleanup-on-inner-window-destroyed"},"Test listener cleanup on inner-window-destroyed"))}m.isMDXComponent=!0},396:function(e,a,r){"use strict";r.d(a,"a",(function(){return d})),r.d(a,"b",(function(){return u}));var n=r(0),t=r.n(n);function o(e,a,r){return a in e?Object.defineProperty(e,a,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[a]=r,e}function i(e,a){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),r.push.apply(r,n)}return r}function l(e){for(var a=1;a<arguments.length;a++){var r=null!=arguments[a]?arguments[a]:{};a%2?i(Object(r),!0).forEach((function(a){o(e,a,r[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))}))}return e}function s(e,a){if(null==e)return{};var r,n,t=function(e,a){if(null==e)return{};var r,n,t={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],a.indexOf(r)>=0||(t[r]=e[r]);return t}(e,a);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],a.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(t[r]=e[r])}return t}var c=t.a.createContext({}),m=function(e){var a=t.a.useContext(c),r=a;return e&&(r="function"==typeof e?e(a):l(l({},a),e)),r},d=function(e){var a=m(e.components);return t.a.createElement(c.Provider,{value:a},e.children)},p={inlineCode:"code",wrapper:function(e){var a=e.children;return t.a.createElement(t.a.Fragment,{},a)}},b=t.a.forwardRef((function(e,a){var r=e.components,n=e.mdxType,o=e.originalType,i=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),d=m(r),b=n,u=d["".concat(i,".").concat(b)]||d[b]||p[b]||o;return r?t.a.createElement(u,l(l({ref:a},c),{},{components:r})):t.a.createElement(u,l({ref:a},c))}));function u(e,a){var r=arguments,n=a&&a.mdxType;if("string"==typeof e||n){var o=r.length,i=new Array(o);i[0]=b;var l={};for(var s in a)hasOwnProperty.call(a,s)&&(l[s]=a[s]);l.originalType=e,l.mdxType="string"==typeof e?e:n,i[1]=l;for(var c=2;c<o;c++)i[c]=r[c];return t.a.createElement.apply(null,i)}return t.a.createElement.apply(null,r)}b.displayName="MDXCreateElement"}}]);