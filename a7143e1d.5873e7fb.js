(window.webpackJsonp=window.webpackJsonp||[]).push([[209],{284:function(e,t,a){"use strict";a.r(t),a.d(t,"frontMatter",(function(){return i})),a.d(t,"metadata",(function(){return s})),a.d(t,"rightToc",(function(){return c})),a.d(t,"default",(function(){return d}));var n=a(3),r=a(8),o=(a(0),a(396)),i={id:"data-store",title:"Data Store"},s={unversionedId:"06.api/web-apis/dataStore/data-store",id:"06.api/web-apis/dataStore/data-store",isDocsHomePage:!1,title:"Data Store",description:"Description",source:"@site/docs/06.api/web-apis/dataStore/data-store.md",slug:"/06.api/web-apis/dataStore/data-store",permalink:"/docs/06.api/web-apis/dataStore/data-store",version:"current"},c=[{value:"Description",id:"description",children:[{value:"Change management and conflict resolution",id:"change-management-and-conflict-resolution",children:[]},{value:"Filtering data",id:"filtering-data",children:[]}]},{value:"Properties",id:"properties",children:[]},{value:"Manifest fields",id:"manifest-fields",children:[]},{value:"DataStore API Interfaces",id:"datastore-api-interfaces",children:[]},{value:"Methods",id:"methods",children:[]},{value:"Examples",id:"examples",children:[]}],l={rightToc:c};function d(e){var t=e.components,a=Object(r.a)(e,["components"]);return Object(o.b)("wrapper",Object(n.a)({},l,a,{components:t,mdxType:"MDXLayout"}),Object(o.b)("h2",{id:"description"},"Description"),Object(o.b)("p",null,"The Data Store API provides a powerful, flexible storage mechanism for KaiOS applications to use to store and share data. It is basically an intermediary store to allow multiple applications to share data between one another quickly, efficiently, and securely, in spite of differences between API data structures, formats, etc.\nData Store API concepts and usage"),Object(o.b)("p",null,"The Data Store API was created to allow multiple KaiOS apps, with potentially different data structures and storage mechanisms, to create, maintain and share the same data objects efficiently between one another. Each app can then import the data into its own local IndexedDB to index according to their specific query needs. This is not necessary however, and you can just write directly to the Data Store API data store."),Object(o.b)("blockquote",null,Object(o.b)("p",{parentName:"blockquote"},Object(o.b)("strong",{parentName:"p"},"Note:")," The Data Store API is available in Web Workers")),Object(o.b)("p",null,"There are several possible reasons to use this API, including:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"It lets an application create data that it can then share with other applications."),Object(o.b)("li",{parentName:"ul"},"It lets multiple applications supply data to the same data store."),Object(o.b)("li",{parentName:"ul"},"It supports read-only data stores such as Facebook contacts (that is, it lets one app create and maintain the data while other apps can read the data from the store)."),Object(o.b)("li",{parentName:"ul"},"It supports read/write data stores, so that multiple applications can contribute data to the same data store. An example would be the device's standard contacts, which can be updated by both the built-in Contacts app and third-party apps."),Object(o.b)("li",{parentName:"ul"},"It supports keeping an application-locale cache of a data store, with notifications to let the app know when there have been changes to the master data store so that the cache can be updated.")),Object(o.b)("p",null,"This Data Store API datastore is owned by a specific app (as specified by the datastores-owned field in the app's manifest \u2014 see Manifest_fields, below), and this ownership gives the app the right to populate the data store and declare whether the data store is ",Object(o.b)("inlineCode",{parentName:"p"},"readonly")," (meaning other apps can only read the data) or ",Object(o.b)("inlineCode",{parentName:"p"},"readwrite")," (meaning other apps can modify the data as well as read it.) Other apps can gain access to a datastore by naming it in the ",Object(o.b)("inlineCode",{parentName:"p"},"datastores-access")," field of their app manifest."),Object(o.b)("p",null,"When an app wants to access a datastore, it has to call ",Object(o.b)("inlineCode",{parentName:"p"},"Navigator.getDataStores()"),"; The result value of this method is a ",Object(o.b)("inlineCode",{parentName:"p"},"Promise")," object that will resolve with an array of ",Object(o.b)("inlineCode",{parentName:"p"},"DataStore")," objects. From these ",Object(o.b)("inlineCode",{parentName:"p"},"DataStore")," objects, the app can read and modify values using various methods of the ",Object(o.b)("inlineCode",{parentName:"p"},"DataStore")," such as ",Object(o.b)("inlineCode",{parentName:"p"},"DataStore.get()")," and ",Object(o.b)("inlineCode",{parentName:"p"},"DataStore.insert()"),"."),Object(o.b)("blockquote",null,Object(o.b)("p",{parentName:"blockquote"},Object(o.b)("strong",{parentName:"p"},"Note:")," The Data Store API currently has no imposed limitations on storage space. This is likely to be updated in the near future.")),Object(o.b)("h3",{id:"change-management-and-conflict-resolution"},"Change management and conflict resolution"),Object(o.b)("p",null,"When multiple apps make changes to a Data Store, it could create conflicts. However, any change you make (using ",Object(o.b)("inlineCode",{parentName:"p"},"DataStore.update()"),", ",Object(o.b)("inlineCode",{parentName:"p"},"DataStore.add()"),", etc.) is given a ",Object(o.b)("inlineCode",{parentName:"p"},"revisionId"),", a UUID received in the change event fired whenever a operation is performed on the Data Store by any app with access to it. This can be read from the ",Object(o.b)("inlineCode",{parentName:"p"},"DataStore.revisionId")," property."),Object(o.b)("p",null,"The ",Object(o.b)("inlineCode",{parentName:"p"},"revisionId")," property can be included as an optional parameter in the ",Object(o.b)("inlineCode",{parentName:"p"},"DataStore.add()"),", ",Object(o.b)("inlineCode",{parentName:"p"},"DataStore.put()"),", ",Object(o.b)("inlineCode",{parentName:"p"},"DataStore.remove()"),", ",Object(o.b)("inlineCode",{parentName:"p"},"DataStore.clear()"),", and ",Object(o.b)("inlineCode",{parentName:"p"},"DataStore.sync()")," methods. Doing so basically uses that ",Object(o.b)("inlineCode",{parentName:"p"},"revisionId")," as a conflict avoider \u2014 the operation is aborted if that revisionId is not the last one known by the Data Store (i.e. if another app has made a more recent change)."),Object(o.b)("p",null,"When the change event is fired, it receives a ",Object(o.b)("inlineCode",{parentName:"p"},"DataStoreChangeEvent")," object, giving the app access to:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"DataStoreChangeEvent.revisionId: The last known revisionId."),Object(o.b)("li",{parentName:"ul"},"DataStoreChangeEvent.id: The key of the changed object, which can be null if the operation was a clear()."),Object(o.b)("li",{parentName:"ul"},"DataStoreChangeEvent.operation: The operation that was performed \u2014 add(), remove(), etc."),Object(o.b)("li",{parentName:"ul"},"DataStoreChangeEvent.owner: The manifest URL of the app that performed this operation.")),Object(o.b)("p",null,"When an app wants to see what has changed, it can do it by asking for the \u2018delta\u2019 between the last known revisionId and the current one. This is done using the DataStore.sync() method. You can allow your apps to deal with data changes by running a sync() on application startup and onchange, passing it the current revisionId to check against."),Object(o.b)("h3",{id:"filtering-data"},"Filtering data"),Object(o.b)("p",null,"As hinted at above, the Data Store API is not responsible for filtering data or building indexes; instead it leaves this up to the the app's local storage mechanism (usually an IndexedDB); The Data Store API simply allows the local indexes to be kept up to date, via the DataStoreCursor object, created when sync() is invoked."),Object(o.b)("h2",{id:"properties"},"Properties"),Object(o.b)("h2",{id:"manifest-fields"},"Manifest fields"),Object(o.b)("p",null,"The data store owner's manifest MUST include the datastores-owned field to claim ownership, for example:"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-json"}),'"datastores-owned": {\n  "myData": {\n    "access": "readwrite",\n    "description": "my data store"\n  }\n}\n')),Object(o.b)("p",null,"You can include multiple properties to represent different data stores, and each one can use readonly/readwrite to specify whether the data store can be read/modified by other applications. A description is also included to describe the purpose of the data store."),Object(o.b)("p",null,"Other applications that want to access (not own) the data store must include the datastores-access field, for example:"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-json"}),'"datastores-access": {\n  "myData": {\n    "access": "readonly",\n    "description": "Read and modify my data store"\n  }\n}\n')),Object(o.b)("p",null,'Without this field being specified, the default behavior is "no access". Again, multiple properties can be included if you want to access multiple data stores, and an access of readonly or readwrite can be set to declare what access type is needed by the app.'),Object(o.b)("p",null,'In terms of permissions, the Data Store owner always wins against the 3rd party apps. if the owner declares "readonly": true in its manifest, any 3rd party app will be in readonly mode also, even if they declare "access": "readwrite" in their manifests. Of course, this isn\u2019t much use if the owner allows the Data Store to be modified by third party apps, so for the moment, Data Store is a certified API. It is likely to come down to privileged when the security model is finalized.'),Object(o.b)("blockquote",null,Object(o.b)("p",{parentName:"blockquote"},'Note: Remember also that in such cases you need to use the type field in your manifest to explicitly declare that your app is an internal/certified app: "type": "certified".')),Object(o.b)("h2",{id:"datastore-api-interfaces"},"DataStore API Interfaces"),Object(o.b)("p",null,"The Data Store API contains the following interfaces:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object(n.a)({parentName:"li"},{href:"/docs/06.api/web-apis/dataStore/datastore"}),Object(o.b)("strong",{parentName:"a"},Object(o.b)("inlineCode",{parentName:"strong"},"DataStore"))),Object(o.b)("br",{parentName:"li"}),"The DataStore interface represents a retrieved set of data, and includes standard properties for accessing the store's name, owner, etc., methods for reading, modifying and syncing the data, and the onchange event handler for reacting to changes to the data."),Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object(n.a)({parentName:"li"},{href:"/docs/06.api/web-apis/dataStore/datastorecursor"}),Object(o.b)("strong",{parentName:"a"},Object(o.b)("inlineCode",{parentName:"strong"},"DataStoreCursor"))),Object(o.b)("br",{parentName:"li"}),"This interface allows the app to iterate through a list of DataStoreTask objects representing the change history of the data store, for use when synchronising the data."),Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object(n.a)({parentName:"li"},{href:"/docs/06.api/web-apis/dataStore/datastorechangeevent"}),Object(o.b)("strong",{parentName:"a"},Object(o.b)("inlineCode",{parentName:"strong"},"DataStoreChangeEvent"))),Object(o.b)("br",{parentName:"li"}),"This interface represents the event related to a record changed in the data store, i.e. this is returned once a change is made and the change event is fired (see DataStore.onchange for the handler), for use when synchronizing individual changes."),Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object(n.a)({parentName:"li"},{href:"/docs/06.api/web-apis/dataStore/datastoretask"}),Object(o.b)("strong",{parentName:"a"},Object(o.b)("inlineCode",{parentName:"strong"},"DataStoreTask"))),Object(o.b)("br",{parentName:"li"}),"This interface represents a record changed in the data store when a DataStoreCursor is used to iterate through the data store's change history.")),Object(o.b)("h2",{id:"methods"},"Methods"),Object(o.b)("h2",{id:"examples"},"Examples"),Object(o.b)("p",null,"We have written a couple of examples that go together, to explain how different apps can make different use of the same data store:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"The Data Store Contacts Editor creates a data store called 'contacts' on the device it is installed on, adds some default data to it, and allows the user to add new contacts to the store and delete contacts."),Object(o.b)("li",{parentName:"ul"},"The Data Store Contacts Viewer has readonly access to the 'contacts' data store; it grabs data from it and displays it in a user interface, along with a Google map of the selected user's location, displayed in an ",Object(o.b)("inlineCode",{parentName:"li"},"<iframe>")," to get around certified app CSP restrictions.")),Object(o.b)("p",null,"Keep referring to these examples and read Using the Data Store API for explanations and code samples."),Object(o.b)("blockquote",null,Object(o.b)("p",{parentName:"blockquote"},Object(o.b)("strong",{parentName:"p"},"Note:")," Be aware that to test data store examples you need to make sure your apps are internal/certified (see above for manifest fields needed), and use App Manager or WebIDE to simulate an environment where a internal/certified app can be run. Follow these links to find out how to do this using each tool: App Manager: Debugging Certified Apps and WebIDE: Debugging Certified Apps.")))}d.isMDXComponent=!0},396:function(e,t,a){"use strict";a.d(t,"a",(function(){return p})),a.d(t,"b",(function(){return u}));var n=a(0),r=a.n(n);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function c(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var l=r.a.createContext({}),d=function(e){var t=r.a.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):s(s({},t),e)),a},p=function(e){var t=d(e.components);return r.a.createElement(l.Provider,{value:t},e.children)},b={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},h=r.a.forwardRef((function(e,t){var a=e.components,n=e.mdxType,o=e.originalType,i=e.parentName,l=c(e,["components","mdxType","originalType","parentName"]),p=d(a),h=n,u=p["".concat(i,".").concat(h)]||p[h]||b[h]||o;return a?r.a.createElement(u,s(s({ref:t},l),{},{components:a})):r.a.createElement(u,s({ref:t},l))}));function u(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var o=a.length,i=new Array(o);i[0]=h;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:n,i[1]=s;for(var l=2;l<o;l++)i[l]=a[l];return r.a.createElement.apply(null,i)}return r.a.createElement.apply(null,a)}h.displayName="MDXCreateElement"}}]);